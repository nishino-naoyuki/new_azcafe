<!DOCTYPE html>
<html lang="en">
<head>
  <meta id="parent" th:replace="/header/include_css"></meta>
</head>
<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
<div class="wrapper">
  <!-- Navbar -->
  <!-- ヘッダー -->
   <div id="parent" th:replace="/header/header"></div>   

  <!-- サイドバー -->
    <div id="parent" th:replace="/header/sidebar"></div>  

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-12">
            <h1 class="m-0">問題詳細</h1>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">        
        <!-- Main row -->
        <div class="row">
          <!-- Left col -->
          <div class="col-md-12">
            <div class="card card-primary shadow-none">
              <div class="card-header">
                <h1 class="card-title" th:text="${assignmentdetailDto.title}"></h1>

                <div class="card-tools">
                  <button type="button" class="btn btn-tool" id="question-edit" data-toggle="tooltip" title="この問題を編集する">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                </div>
                <!-- /.card-tools -->
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <div class="d-flex">
                  <div class="col-md-4">
                    <div class="info-box">
                      <span class="info-box-icon bg-primary"><i class="fas fa-layer-group"></i></span>
        
                      <div class="info-box-content">
                        <span class="info-box-text">問題グループ</span>
                        <span class="info-box-number" th:text="${assignmentdetailDto.groupName}"></span>
                      </div>
                      <!-- /.info-box-content -->
                    </div>
                  </div>
                  
                  <div class="col-md-4">
                    <div class="info-box">
                      <span class="info-box-icon bg-success"><i class="far fa-grin-tongue-squint"></i></span>
        
                      <div class="info-box-content">
                        <span class="info-box-text">問題難易度</span>
                        <span class="info-box-number" th:text="${assignmentdetailDto.difficulty}"></span>
                      </div>
                      <!-- /.info-box-content -->
                    </div>
                  </div>
                  
                  <div class="col-md-4">
                    <div class="info-box">
                      <span class="info-box-icon bg-danger"><i class="fas fa-file-alt"></i></span>
        
                      <div class="info-box-content score_result" data-toggle="tooltip" title="提出済みの場合はクリックで詳細へ">
                        <span class="info-box-text">提出状況</span>
                        <span class="info-box-number" th:text="${assignmentdetailDto.score}"></span>
                      </div>
                      <!-- /.info-box-content -->
                    </div>
                  </div>
                    
                </div>
                
                <!-- 問題文 -->
                <div class="col-md-12">
                  <div class="card card-outline card-primary">
                    <div class="card-header">
                      <h3 class="card-title">問題文</h3>
                    </div>
                    <div class="card-body" th:utext="${assignmentdetailDto.content}">
                    </div>
                  </div>
                </div>
                <!-- 回答欄 -->
                <div class="col-md-12">
                  
                  <div class="card">
                    <div class="card-header d-flex p-0">
                      <h3 class="card-title p-3">解答欄</h3>
                      <ul class="nav nav-pills ml-auto p-2">
                        <li class="nav-item"><a class="nav-link active" href="#tab_1" data-toggle="tab">直接入力</a></li>
                        <li class="nav-item"><a class="nav-link" href="#tab_2" data-toggle="tab">ファイルアップロード</a></li>
                      </ul>
                    </div>
	                    <div class="card-body">
	                      <div class="tab-content">
	                        <!--1ページ目-->
	                        <div class="tab-pane active" id="tab_1">
                    		  <form id="answer_text_form">
		                          <div class="editor_container">
		                            <div class="answer_wrap">
		                              <div class="title_wrap mb15">
		                                <h3 class="h3_title">
		                                解答欄
		                                </h3>
		                                <div class="answer_wrap_option d-flex">
		                                    <button class="btn btn-default btn-sm m-r-5" data-placement="bottom" id="code_plus">
		                                    <i class="fa fa-search-plus" data-toggle="tooltip" title="大きくする"></i>
		                                    </button>
		                                    <button class="btn btn-default btn-sm m-r-5" data-placement="bottom" id="code_minus">
		                                    <i class="fa fa-search-minus" data-toggle="tooltip" title="小さくする"></i>
		                                    </button>
		                                  <select class="box form-control" name="language" id="language_id">
		                                    <option value="">使用する言語</option>
		                                    <option value="0">Java</option>
		                                    <option value="1">JavaScript</option>
		                                  </select>
		                                </div>
		                              </div>
		                              <div id="editor" style="height: 600px" th:text="${assignmentdetailDto.answer}" ></div>
		                              <textarea id="answer_text" name="answerText" style="display: none;" ></textarea>
		                              <div class="footer d-flex justify-content-between">
		                                <div class="col-md-3">
		                                  <button type="button" class="btn btn-primary" id="answer_btn" data-toggle="tooltip" title="提出して採点します">提出</button>
		                                </div>
		                                <div class="col-md-3">
		                                  <div class="info-box">
		                                    <span class="info-box-icon bg-primary"><i class="fas fa-pen"></i></span>
		                      
		                                    <div class="info-box-content score_result"  data-toggle="tooltip" title="提出済みの場合はクリックで詳細へ">
		                                      <span class="info-box-text">採点結果</span>
		                                      <span class="info-box-number" th:text="${assignmentdetailDto.score}"></span>
		                                    </div>
		                                    <!-- /.info-box-content -->
		                                  </div>
		                                </div>
		                              </div>                            
		                            </div>
		                          </div>
	                          </form>
	                        </div>
	                        <!--2ページ目-->
	                        <div class="tab-pane" id="tab_2">
	                          <form id="answer_file_form">
		                          <div class="answer_wrap">
		                            <div class="form-group input-file-group d-flex">
		                              <div class="input-group col-md-8">
		                                <div class="custom-file">
		                                  <input type="file" class="custom-file-input" id="exampleInputFile1" name="answerFile1" >
		                                  <label class="custom-file-label" for="exampleInputFile1">Choose file</label>
		                                </div>
		                              </div>
		                            </div>
		                            <div class="form-group input-file-group d-flex">
		                              <div class="input-group col-md-8">
		                                <div class="custom-file">
		                                  <input type="file" class="custom-file-input" id="exampleInputFile2" name="answerFile2" >
		                                  <label class="custom-file-label" for="exampleInputFile2">Choose file</label>
		                                </div>
		                              </div>
		                            </div>
		                            <div class="form-group input-file-group d-flex">
		                              <div class="input-group col-md-8">
		                                <div class="custom-file">
		                                  <input type="file" class="custom-file-input" id="exampleInputFile3" name="answerFile3" >
		                                  <label class="custom-file-label" for="exampleInputFile3">Choose file</label>
		                                </div>
		                              </div>
		                            </div>
		                            <div class="form-group input-file-group d-flex">
		                              <div class="input-group col-md-8">
		                                <div class="custom-file">
		                                  <input type="file" class="custom-file-input" id="exampleInputFile4" name="answerFile4" >
		                                  <label class="custom-file-label" for="exampleInputFile4">Choose file</label>
		                                </div>
		                              </div>
		                            </div>
		                            <div class="form-group input-file-group d-flex">
		                              <div class="input-group col-md-8">
		                                <div class="custom-file">
		                                  <input type="file" class="custom-file-input" id="exampleInputFile5" name="answerFile5" >
		                                  <label class="custom-file-label" for="exampleInputFile5">Choose file</label>
		                                </div>
		                              </div>
		                            </div>
		                            <div class="footer d-flex justify-content-between">
		                              <div class="col-md-3">
		                                <button type="button" class="btn btn-primary" id="answer_file_btn" data-toggle="tooltip" title="提出して採点します">提出</button>
		                              </div>
		                              <div class="col-md-3">
		                                <div class="info-box">
		                                  <span class="info-box-icon bg-primary"><i class="fas fa-pen"></i></span>
		                    
		                                  <div class="info-box-content score_result" data-toggle="tooltip" title="提出済みの場合はクリックで詳細へ">
		                                    <span class="info-box-text">採点結果</span>
		                                    <span class="info-box-number" th:text="${assignmentdetailDto.score}"></span>
		                                  </div>
		                                  <!-- /.info-box-content -->
		                                </div>
		                              </div>
		                            </div> 
		                          </div>
	                          </form>
	                        </div>
	                      </div>
	                    </div>
                    
                    <div class="overlay dark" id="waiting">
                      採点中・・・
                      <i class="fas fa-2x fa-sync-alt fa-spin"></i>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /.card-body -->
            </div>
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div><!--/. container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->
<meta id="parent" th:replace="/header/include_js"></meta>

<!-- bs-custom-file-input -->
<script th:src="@{/plugins/bs-custom-file-input/bs-custom-file-input.min.js}"></script>
<!-- ace -->
  <script th:src="@{/ace/src/ace.js}" type="text/javascript" charset="utf-8"></script>
  <script th:src="@{ace/src/ext-language_tools.js}" type="text/javascript" charset="utf-8"></script>
<script>
$(function () {
  bsCustomFileInput.init();
});

  const editor = ace.edit("editor");
  const defaultFontSize = 14;
  const MaxFontSize = 30;
  const MinFontSize = 10;
  let ctrlNum = 1;
  let fontsize = localStorage.getItem("codeFont");
  if( fontsize == null ){
    fontsize = defaultFontSize;
  }
  editor.setOptions({
      enableSnippets: true
    });
  editor.setTheme("ace/theme/eclipse");
  editor.setFontSize(Number(fontsize));
  editor.session.setMode("ace/mode/java");

  $(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
    $("#waiting").hide();
  });

  //＋ボタンクリック
  $(document).on('click','#code_plus',function(){
    checkFontSize();
    if($(this).prop("disabled") == false){
      fontsize++;
      editor.setFontSize(fontsize);
      localStorage.setItem("codeFont",fontsize);
    }
    
  })
  //－ボタンクリック
  $(document).on('click','#code_minus',function(){
    checkFontSize();
    if( $(this).prop("disabled") == false ){
      fontsize--;
      editor.setFontSize(fontsize);
      localStorage.setItem("codeFont",fontsize);
    }
  })
  //－ボタンクリック
  $(document).on('click','#question-edit',function(){
    alert("click edit");
    window.location.href = 'question-create.html';
  })
  const checkFontSize = () =>{
    let ret = true;
    if( fontsize <= MinFontSize ){
      $("#code_plus").prop("disabled", false);
      $("#code_minus").prop("disabled", true);
      ret = false;
    }else if( fontsize >= MaxFontSize ){
      $("#code_plus").prop("disabled", true);
      $("#code_minus").prop("disabled", false);
      ret = false;
    }else{
      $("#code_plus").prop("disabled", false);
      $("#code_minus").prop("disabled", false);
    }

    return ret;
  }

  //提出ボタン
  $(document).on('click','#answer_btn',function(){
    const langId = $("#language_id").val();
   
    if( langId.length == 0 ){
      alert("言語を選択してください");
      return;
    }
    
    $("#waiting").show();
    
    const ansText = editor.getValue();
    $("#answer_text").val(ansText);
    const formdata = new FormData($('#answer_text_form').get(0));
    const ajaxUrl = /*[[@{/grading/file}]]*/ "/grading/file";
    $.ajax({
        url  : ajaxUrl,
        type : "POST",
        data : formdata,
        cache       : false,
        contentType : false,
        processData : false,
        dataType    : "html"
    })
    .done(function(data, textStatus, jqXHR){
        alert(data);
        $("#waiting").hide();
    })
    .fail(function(jqXHR, textStatus, errorThrown){
        alert("fail");
        $("#waiting").hide();
    });
    //alert(langId+":"+ansText);
    //$("#waiting").hide();
  })
  
  //提出ボタン（ファイル）
  $(document).on('click','#answer_file_btn',function(){
    const inputVal = $("#exampleInputFile1").val();
    if( inputVal.length == 0 ){
      alert("ファイルを選択してください");
      return;
    }
    alert(inputVal);
    $("#waiting").show();
    //alert(langId+":"+ansText);
    //$("#waiting").hide();
  })

  //スコア詳細ボタン
  $(document).on('click','.score_result',function(){
	  alert("!");
  });

</script>

</body>

</html>