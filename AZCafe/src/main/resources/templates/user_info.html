<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta id="parent" th:replace="/header/include_css"></meta>
  <!-- DataTables -->
  <link rel="stylesheet" th:href="@{/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
  <link rel="stylesheet" th:href="@{/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
  <link rel="stylesheet" th:href="@{/plugins/datatables-buttons/css/buttons.bootstrap4.min.css}">
</head>
<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
<div class="wrapper">
  <!-- ヘッダー -->
   <div id="parent" th:replace="/header/header"></div>   
  <!-- サイドバー -->
    <div id="parent" th:replace="/header/sidebar"></div>  

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-12">
            <h1 class="m-0">ユーザー情報</h1>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-3">

            <!-- Profile Image -->
            <div class="card card-primary card-outline">
              <div class="card-body box-profile">
		          <div class="text-center" th:unless="${userInfoDto.avater}">
		            <img th:src="@{/img/no_image.jpg}" class="profile-user-img img-fluid img-circle" alt="User Image">
		          </div>
		          <div class="text-center" th:if="${userInfoDto.avater}">
		            <img th:src="@{'/getImage/'+${userInfoDto.avater}}" class="profile-user-img img-fluid img-circle" alt="User Image">
		          </div>
                <i id="edit-myicon" class="far fa-edit small-icon" data-toggle="tooltip" title="アイコンの編集"></i>

                <h3 class="profile-username text-center" th:text="${userInfoDto.nickName}" ></h3>

                <p class="text-muted text-center" th:text="${userInfoDto.homeroomeName}" ></p>

                <ul class="list-group list-group-unbordered mb-3">
                  <li class="list-group-item">
                    <b>フォロー数</b> <a class="float-right" th:text="${userInfoDto.followNum}"></a>
                  </li>
                  <li class="list-group-item">
                    <b>フォロワー数</b> <a class="float-right" th:text="${userInfoDto.followerNum}"></a>
                  </li>
                  <li class="list-group-item">
                    <b>称号</b> <a class="float-right" th:text="${userInfoDto.level}"></a>
                  </li>
                </ul>
                <div th:unless="${userInfoDto.userId} eq ${session['LoginInfo'].userId}">
			      <button class="btn-sm btn-default btn-follow-btn" th:classappend="${userInfoDto.isFollowUser} ? d-none : '' " th:data-id="${userInfoDto.userId}">フォローする</button>
			      <button class="btn-sm btn-primary btn-follow-release" th:classappend="${userInfoDto.isFollowUser} ? '' : d-none"  th:data-id="${userInfoDto.userId}">フォロー解除</button>
                </div>              
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->

            <!-- About Me Box -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">ユーザー情報</h3>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <strong><i class="fas fa-id-card mr-1"></i> 学籍番号</strong>
                <p class="text-muted" th:text="${userInfoDto.OrgNo}" >
                  
                </p>
                <hr>
                <strong><i class="fas fa-signature mr-1"></i> ニックネーム</strong><i th:if="${userInfoDto.userId} eq ${session['LoginInfo'].userId}" id="edit-nickname" class="far fa-edit small-icon" data-toggle="tooltip" title="ニックネームの編集"></i>
                <p class="text-muted" id="nickname-label" th:text="${userInfoDto.nickName}"></p>
                <div th:if="${userInfoDto.userId} eq ${session['LoginInfo'].userId}" id="nickname-edit" class="d-none">
                  <input type="text" class="form-control" th:value="${userInfoDto.nickName}" >
                  <button class="btn-sm btn-primary" id="btn-nickname-appy">適用</button>
                </div>
                <hr>
                <div th:if="${userInfoDto.userId} eq ${session['LoginInfo'].userId}">
	                <strong><i class="fas fa-user-lock"></i> パスワード変更</strong>
	                <div id="nickname-edit" class="form-group d-flat">
	                  <form>
	                    <input type="password" class="form-control" value="">
	                    <input type="password" class="form-control" value="">
	                    <button class="btn-sm btn-primary" id="btn-password-change">変更</button>
	                  </form>
	                </div>
                </div>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
          <div class="col-md-9">
            <div class="card">
              <div class="card-header p-2">
                <ul class="nav nav-pills">
                  <li class="nav-item"><a class="nav-link active" href="#answer-list" data-toggle="tab">解答一覧</a></li>
                  <li class="nav-item"><a class="nav-link" href="#follow-list" data-toggle="tab">フォローリスト</a></li>
                  <li class="nav-item"><a class="nav-link" href="#follower-list" data-toggle="tab">フォロワーリスト</a></li>
                </ul>
              </div><!-- /.card-header -->
              <div class="card-body">
                <div class="tab-content">
                  <div class="active tab-pane" id="answer-list">
                    <table id="example1" class="table table-bordered table-striped">
                      <thead>
                      <tr>
                        <th>グループ</th>
                        <th>問題名</th>
                        <th>提出日</th>
                        <th>点数</th>
                      </tr>
                      </thead>
                      <tbody>
	                      <tr th:each="result ,status:${userInfoDto.assignmentRetList}">
	                        <td th:text="${result.group}"></td>
	                        <td>
	                          <div class="d-flex flex-column">
	                            <a th:href="@{'/assignment/result?assignmentId='}+${result.assigmentId}" class="answer-list-q" th:text="${result.title}"></a>
	                            <div class="d-flex flex-row">
	                              <i class="far fa-thumbs-up"></i><div class="normal-text" th:text="${result.goodNum}"></div>
	                              <i class="far fa-comment"></i><div class="normal-text" th:text="${result.commentNum}"></div>
	                            </div>
	                          </div>
	                        </td> 
	                        <td>2020/12/27</td>
	                        <td  th:text="${result.score}">100</td>
	                      </tr>
                      </tbody>
                    </table>
                  </div>
                  <!-- /.tab-pane -->
                  <div class="tab-pane" id="follow-list">
                    <!--フォローリスト-->
                    <div class="f-list-box" >
                      <ul class="products-list product-list-in-card pl-2 pr-2">
                        <li class="item user-label" th:each="follow ,status:${userInfoDto.followList}" th:data-id="${follow.userId}" >
                          <div class="product-img">
	                          <img th:unless="${follow.avater}" th:src="@{/img/no_image.jpg}" alt="Product Image" class="img-size-50">
	                          <img th:if="${follow.avater}" th:src="@{'/getImage/'+${follow.avater}}" alt="Product Image" class="img-size-50">
	                        </div>
	                        <div class="product-info">
	                          <span class="product-title" th:text="${follow.hoomroomName}"></span>
	                          <span class="product-description">
	                            <th:block th:text="${follow.nickName}"></th:block>
	                            <div class="product-button">
	                              <button class="btn-sm btn-primary btn-follow-release" th:data-id="${follow.userId}">フォロー解除</button>     
	                            </div>
	                          </span>
	                        </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <!-- /.tab-pane -->
                  <div class="tab-pane" id="follower-list">
	                    <!--フォロワーリスト-->
	                    <div class="f-list-box" >
	                      <ul class="products-list product-list-in-card pl-2 pr-2">
	                        <li class="item user-label" th:each="follower ,status:${userInfoDto.followerList}" th:data-id="${follower.userId}" >
	                          <div class="product-img">
		                          <img th:unless="${follower.avater}" th:src="@{/img/no_image.jpg}" alt="Product Image" class="img-size-50">
		                          <img th:if="${follower.avater}" th:src="@{'/getImage/'+${follower.avater}}" alt="Product Image" class="img-size-50">
		                        </div>
		                        <div class="product-info">
		                          <span class="product-title" th:text="${follower.hoomroomName}"></span>
		                          <span class="product-description">
		                            <th:block th:text="${follower.nickName}"></th:block>
		                            <div class="product-button">
			                            <button class="btn-sm btn-default btn-follow-btn" th:classappend="${follower.isEach} ? d-none : '' " th:data-id="${follower.userId}">フォローする</button>
			                            <button class="btn-sm btn-primary btn-follow-release" th:classappend="${follower.isEach} ? '' : d-none"  th:data-id="${follower.userId}">フォロー解除</button>
		                            </div>
		                          </span>
		                        </div>
	                        </li>
	                      </ul>
	                    </div>
                  </div>
                  <!-- /.tab-pane -->
                </div>
                <!-- /.tab-content -->
              </div><!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->
<meta id="parent" th:replace="/header/include_js"></meta>

<!-- DataTables  & Plugins -->
<script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
<script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
<script th:src="@{/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
<script th:src="@{/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>
<script th:src="@{/plugins/datatables-buttons/js/dataTables.buttons.min.js}"></script>
<script th:src="@{/plugins/datatables-buttons/js/buttons.bootstrap4.min.js}"></script>
<script th:src="@{/plugins/jszip/jszip.min.js}"></script>
<script th:src="@{/plugins/pdfmake/pdfmake.min.js}"></script>
<script th:src="@{/plugins/pdfmake/vfs_fonts.js}"></script>
<script th:src="@{/plugins/datatables-buttons/js/buttons.html5.min.js}"></script>
<script th:src="@{/plugins/datatables-buttons/js/buttons.print.min.js}"></script>
<script th:src="@{/plugins/datatables-buttons/js/buttons.colVis.min.js}"></script>

<script>
  $(document).on('click', '#edit-nickname', function(){
        let label = document.getElementById("nickname-label");

        if(label.style.display=="block"){
          label.style.display = "none";
          $("#nickname-edit").removeClass("d-none");
        }else{
          label.style.display = "block";
          $("#nickname-edit").addClass("d-none");
        }
  });

  $(document).on('click','#btn-nickname-appy',function(){
    alert("click! btn-nickname-appy")
  })

  $(document).on('click','#btn-password-change',function(){
    alert("click! btn-password-change")
  })
  $(document).on('click',"#btn-follow-release",function(){
    let id = $(this).data("id");
    alert("btn-follow-release id="+id);
  })

  $(document).on('click',".btn-follow-btn",function(){
    let userId = $(this).data("id");
    let buttonObj = $(this);
    alert("btn-follow id="+userId);

	$.ajax({
        type : "POST",                  // HTTP通信の種類
        url  : /*[[@{/user/follow}]]*/ "/user/follow",                 // リクエストを送信する先のURL
        dataType : "text",              // サーバーから返されるデータの型
        data : {userId: userId}
	}).done(function(data) {
		//今のボタンを解除して、もう片方を表示する
		buttonObj.parent().find(".d-none").removeClass("d-none");
		buttonObj.addClass("d-none");	
		if( data == "ok"){
			alert("登録しました");
		}else{
			alert("登録に失敗しました");
		}
	}).fail(function(XMLHttpRequest, textStatus, errorThrown) { // Ajax通信が失敗した時の処理
        alert("登録に失敗しました");
    });
  })
  
  $(function () {
    $('#example1').DataTable({
      "paging": true,
      "lengthChange": false,
      "searching": false,
      "ordering": true,
      "info": true,
      "autoWidth": false,
      "responsive": true,
    });
  });
</script>
</body>

</html>
